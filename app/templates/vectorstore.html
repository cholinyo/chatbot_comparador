{% extends "base.html" %}
{% block title %}📦 VectorStore{% endblock %}
{% block content %}

<div class="container mt-4">
  <h2 class="mb-4">📦 VectorStore: Fragmentos Indexados</h2>

  {% if resumen %}
  <div class="alert alert-info">
    <strong>Resumen general:</strong><br>
    Total de fragmentos: <strong>{{ resumen.total_fragmentos }}</strong><br>
    Dimensiones del vector: <strong>{{ resumen.dimensiones }}</strong><br>
    Última actualización: <strong>{{ resumen.fecha }}</strong>
  </div>
  {% endif %}

  <h4>📄 Documentos cargados ({{ documentos|length }})</h4>
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Nombre</th>
        <th>Fragmentos</th>
        <th>Fuente</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      {% for doc in documentos %}
      <tr>
        <td>{{ doc.nombre }}</td>
        <td>{{ doc.fragmentos }}</td>
        <td>{{ doc.origen }}</td>
        <td>
          <a href="/vectorstore/documento/{{ doc.nombre | urlencode }}" class="btn btn-sm btn-outline-primary">Ver fragmentos</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h4 class="mt-5">🌐 URLs indexadas ({{ urls|length }})</h4>
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>URL</th>
        <th>Fragmentos</th>
        <th>Fuente</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      {% for url in urls %}
      <tr>
        <td>{{ url.nombre }}</td>
        <td>{{ url.fragmentos }}</td>
        <td>{{ url.origen }}</td>
        <td>
          <a href="/vectorstore/documento/{{ url.nombre | urlencode }}" class="btn btn-sm btn-outline-primary">Ver fragmentos</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if ejemplo_embedding %}
  <div class="card mt-5">
    <div class="card-header">🧠 Ejemplo de vector de embedding</div>
    <div class="card-body">
      <pre style="max-height: 250px; overflow-y: auto;">{{ ejemplo_embedding }}</pre>
    </div>
  </div>
  {% endif %}

  {% if log_docs %}
  <div class="card mt-5">
    <div class="card-header">📜 Log de ingesta de documentos</div>
    <div class="card-body">
      <pre style="max-height: 300px; overflow-y: scroll;">{{ log_docs }}</pre>
    </div>
  </div>
  {% endif %}

  {% if log_web %}
  <div class="card mt-5">
    <div class="card-header">🌐 Log de ingesta desde URLs</div>
    <div class="card-body">
      <pre style="max-height: 300px; overflow-y: scroll;">{{ log_web }}</pre>
    </div>
  </div>
  {% endif %}

</div>

{% endblock %}
