
{% extends "base.html" %}
{% block title %}📦 VectorStore{% endblock %}
{% block content %}

<div class="container mt-4">
  <h2 class="mb-4">📦 VectorStore: Estado de las Fuentes Indexadas</h2>

  {% if resumen_docs %}
  <div class="alert alert-primary">
    <strong>📄 Documentos:</strong><br>
    Total de fragmentos: <strong>{{ resumen_docs.total_fragmentos }}</strong><br>
    Dimensiones de vector: <strong>{{ resumen_docs.dimensiones }}</strong><br>
    Última actualización: <strong>{{ resumen_docs.fecha }}</strong>
  </div>
  {% endif %}

  {% if resumen_web %}
  <div class="alert alert-success">
    <strong>🌐 Webs:</strong><br>
    Total de fragmentos: <strong>{{ resumen_web.total_fragmentos }}</strong><br>
    Dimensiones de vector: <strong>{{ resumen_web.dimensiones }}</strong><br>
    Última actualización: <strong>{{ resumen_web.fecha }}</strong>
  </div>
  {% endif %}

  <h4>📄 Documentos cargados ({{ documentos|length }})</h4>
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Nombre</th>
        <th>Origen</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      {% for doc in documentos %}
      <tr>
        <td>{{ doc.nombre }}</td>
        <td>{{ doc.origen }}</td>
        <td>
          <a href="/vectorstore/documento/{{ doc.nombre | urlencode }}" class="btn btn-sm btn-outline-primary">Ver fragmentos</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h4 class="mt-5">🌐 URLs indexadas ({{ urls|length }})</h4>
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>URL</th>
        <th>Origen</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      {% for url in urls %}
      <tr>
        <td>{{ url.nombre }}</td>
        <td>{{ url.origen }}</td>
        <td>
          <a href="/vectorstore/documento/{{ url.nombre | urlencode }}" class="btn btn-sm btn-outline-primary">Ver fragmentos</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if ejemplo_embedding_docs %}
  <div class="card mt-5">
    <div class="card-header">🧠 Ejemplo de vector (documentos)</div>
    <div class="card-body">
      <pre style="max-height: 250px; overflow-y: auto;">{{ ejemplo_embedding_docs }}</pre>
    </div>
  </div>
  {% endif %}

  {% if ejemplo_embedding_web %}
  <div class="card mt-4">
    <div class="card-header">🌐 Ejemplo de vector (web)</div>
    <div class="card-body">
      <pre style="max-height: 250px; overflow-y: auto;">{{ ejemplo_embedding_web }}</pre>
    </div>
  </div>
  {% endif %}

  {% if log_docs %}
  <div class="card mt-5">
    <div class="card-header">📜 Log de ingesta de documentos</div>
    <div class="card-body">
      <pre style="max-height: 300px; overflow-y: scroll;">{{ log_docs }}</pre>
    </div>
  </div>
  {% endif %}

  {% if log_web %}
  <div class="card mt-4">
    <div class="card-header">🌐 Log de ingesta desde URLs</div>
    <div class="card-body">
      <pre style="max-height: 300px; overflow-y: scroll;">{{ log_web }}</pre>
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
